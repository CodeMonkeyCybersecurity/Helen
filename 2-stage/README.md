# NGINX HTTPS Setup with Certbot

This project sets up an NGINX web server using Docker Compose to serve static files with HTTPS enabled, leveraging Let’s Encrypt certificates generated by Certbot.

### Features

• Lightweight NGINX container based on the nginx:alpine image.

• Automatic HTTPS certificate generation using Certbot.

• Support for serving custom static files from the html directory.

• Automatic redirection from HTTP to HTTPS.

• Docker Compose for easy deployment and management.
 

### Requirements

• Docker and Docker Compose installed on your server.
 
• A domain name (cybermonkey.dev) pointing to your server’s IP address.
 
• Certbot installed on your server for certificate generation.

 

## Project Structure

```
├── docker-compose.yaml         # Docker Compose configuration file
├── _/                      # Directory for your static website files
├── index.html             # Example HTML file
├── nginx.conf                 # Custom NGINX configuration file
├── certs/                     # Directory for SSL certificates 
└── README.md                  # Documentation for the setup
```
## Setup Instructions

### 1. Clone the Repository

Clone this repository to your server:
```
git clone <repository-url>
cd <repository-directory>
```

Below is a simple, reliable approach to obtain SSL certificates with Certbot and use them in an NGINX Docker container—without battling volume-mount issues for Let’s Encrypt directories. This method involves two separate steps:
1.	Use Certbot on the host (outside of Docker) to obtain certificates.

2.	Mount the certificates into your Dockerized NGINX.

By doing it this way, you avoid dealing with /var/lib/letsencrypt or /etc/letsencrypt inside Docker. Once you have your certificates on the host, you simply share them with the NGINX container.

## Option A: Generate Certificates Directly on the Host
### 1.	Stop Any Services on Port 80
Stop or remove any containers or services (like NGINX) that are currently listening on port 80:
```
docker-compose down
sudo systemctl stop nginx
```
This is necessary because Certbot’s standalone mode needs to bind port 80.

### 2.	Install Certbot on the Host
On Ubuntu/Debian:
```
sudo apt update
sudo apt install certbot
```

### 3.	Obtain the Certificates (Standalone Mode)
Run Certbot to generate certificates using its built-in standalone server:
```
sudo certbot certonly --standalone \
    -d cybermonkey.dev \
    --email main@cybermonkey.dev \
    --agree-tos \
```
This will spin up a temporary web server on port 80. Certbot will place certificates in /etc/letsencrypt/live/cybermonkey.dev/.

### 4.	Verify Certificate Files
After a successful run, check:
```
ls -l /etc/letsencrypt/live/cybermonkey.dev/
```

You should see:
•	cert.pem

•	chain.pem

•	fullchain.pem

•	privkey.pem

### 5.	Create a Local Directory for Docker
Make a local directory in your project for the certs:
```
mkdir certs
```
Copy your certificates into it:
```
sudo cp /etc/letsencrypt/live/cybermonkey.dev/fullchain.pem certs/
sudo cp /etc/letsencrypt/live/cybermonkey.dev/privkey.pem certs/
```
Adjust permissions to be readable:
```
sudo chmod 644 certs/fullchain.pem
sudo chmod 600 certs/privkey.pem
```

### 6.	Use the Certificates in Docker
In your docker-compose.yaml, mount the local certs folder into the container:

```
services:
  nginx:
    image: nginx:alpine
    container_name: helen-stage
    volumes:
      - ./html:/usr/share/nginx/html:ro
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
      - ./certs:/etc/nginx/certs:ro
    ports:
      - "80:80"
      - "443:443"
    restart: always
```

### 7.	Configure nginx.conf
Point to the copied certs in /etc/nginx/certs:
```
server {
    listen 80;
    server_name cybermonkey.dev;
    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl;
    server_name cybermonkey.dev;

    ssl_certificate /etc/nginx/certs/fullchain.pem;
    ssl_certificate_key /etc/nginx/certs/privkey.pem;

    location / {
        root /usr/share/nginx/html;
        index index.html;
    }
}
```

### 8.	Start NGINX
With certificates in place and nginx.conf updated, start your container:
```
docker-compose up -d
```
You should now be able to browse to https://cybermonkey.dev.

### 9.	Automate Certificate Renewal (Optional)
•	Since Certbot is on your host, just rely on its standard cron-based renewal:
```
sudo certbot renew
```

•	If renewal updates your cert files, copy them again into ./certs/ or symlink them.

•	Then restart the container for changes to take effect:
```
docker-compose restart
```
