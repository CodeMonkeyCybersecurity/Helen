<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Cybersecurity with Humans">
    <title>Installing Wazuh on a Local Backend - Athena Knowledge Base | Code Monkey Cybersecurity</title>
    <link rel="stylesheet" href="../openColour/open-color.css">
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="icon" type="image/x-icon" href="../images/favicon-circular-128x128.png">
</head>
<body>
    <header>
        <h1>
            <a href="/" class="logo-link">
                <img src="/images/fingerprint_flipped_whitebackground_circle_1000dp_oc-teal-9_FILL0_wght400_GRAD0_opsz48.png" 
                     alt="Code Monkey Logo" class="logo-image">
            </a>
            Installing Wazuh on a Local Backend
        </h1>
        <p>Cybersecurity with Humans</p>
    </header>
    
    <!-- Navigation Menu -->
    <nav>
        <ul>
            <li><a href="/index.html">Home</a></li>
            <li><a href="/index.html#services">Services</a></li>
            <li><a href="/index.html#why-us">Why Choose Us?</a></li>
            <li><a href="/index.html#contact">Contact Us</a></li>
            <li><a href="/_/delphi_roadmap.html">Wazuh Roadmap (Project Delphi)</a></li>
            <li><a href="/_/athena.html">Knowledge Base</a></li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="container">
        <section class="section">
            <h2>Installing Wazuh on a Local Backend in a Docker Container</h2>
            <p>This guide explains how to install Wazuh in a Docker container, enabling access via a remote reverse proxy for internet accessibility. If you intend to expose Wazuh to the internet, please read these instructions alongside the <a href="https://github.com/CodeMonkeyCybersecurity/hecate.git">Hecate reverse proxy instructions</a>.</p>
            <p>Up-to-date instructions are available <a href="https://documentation.wazuh.com/current/deployment-options/docker/index.html">on Wazuh's website</a>.</p>
        </section>

        <section class="section">
            <h2>Prerequisites</h2>
            <h3>Make Sure Docker is Installed</h3>
            <p><strong>If Docker is not installed, you can follow <a href="https://github.com/CodeMonkeyCybersecurity/eos/tree/main/legacy/docker">these instructions</a>.</strong></p>
        </section>

        <section class="section">
            <h3>Docker Modification</h3>
            <p>Prior to installing Wazuh, you need to increase <code>max_map_count</code> on your Docker host:</p>
            <pre><code>sysctl -w vm.max_map_count=262144
            </code></pre>
        </section>

        <section class="section">
            <h2>Single Node Deployment</h2>
            
            <h3>Navigate to Your Home Directory and Clone the Repository</h3>
            <p>Clone the repository into a suitable directory for installation:</p>
            <pre><code>cd $HOME
git clone https://github.com/wazuh/wazuh-docker.git -b v4.10.0
cd $HOME/wazuh-docker/single-node

# Verify the present working directory (pwd)
pwd
echo "verify the present working directory (pwd) is cd $HOME/wazuh-docker/single-node"
            </code></pre>
            <p>This installation location assumes you will be administering the Wazuh installation because it is being installed in your home directory.</p>
        </section>

        <section class="section">
            <h3>Generate Self-Signed Certificates for Each Cluster Node</h3>
            <p>We have created a Docker image to automate certificate generation using the Wazuh certs gen tool.</p>
            <p>If your system uses a proxy (such as <a href="https://github.com/CodeMonkeyCybersecurity/hecate.git">Hecate</a>), add the following to the <code>generate-indexer-certs.yml</code> file:</p>
            <p>As a reminder, if you are using Wazuh alongside other web applications, you need to install Wazuh on a subdomain. For example, if your main domain is <code>domain.com</code>, Wazuh should be on a subdomain like <code>wazuh.domain.com</code>. If you want to install it at a path like <code>domain.com/wazuh</code>, you will need to rewrite a significant amount of JavaScript. <a href="https://github.com/CodeMonkeyCybersecurity/hecate.git">Hecate</a> provides a template for installing Wazuh fairly easily.</p>
            <pre><code>environment:
  - HTTP_PROXY=YOUR_PROXY_ADDRESS_OR_DNS
            </code></pre>
            <p>To do this, navigate to:</p>
            <pre><code>cd $HOME/wazuh-docker/single-node
nano generate-indexer-certs.yml
            </code></pre>
            <p>Paste the following at the bottom of the file:</p>
            <pre><code>    environment:
      - HTTP_PROXY=wazuh.domain.com
            </code></pre>
            <p>You can check your YAML syntax <a href="https://www.yamllint.com/">here</a>.</p>
            <p>The complete example looks like:</p>
            <pre><code># Wazuh App Copyright (C) 2017 Wazuh Inc. (License GPLv2)
version: '3'

services:
  generator:
    image: wazuh/wazuh-certs-generator:0.0.2
    hostname: wazuh-certs-generator
    volumes:
      - ./config/wazuh_indexer_ssl_certs/:/certificates/
      - ./config/certs.yml:/config/certs.yml
    environment:
      - HTTP_PROXY=wazuh.domain.com
            </code></pre>
            <p>Create the desired certificates:</p>
            <pre><code>cd $HOME/wazuh-docker/single-node
docker compose -f generate-indexer-certs.yml run --rm generator
            </code></pre>
        </section>

        <section class="section">
            <h3>Exposing the Correct Ports on the Backend</h3>
            <p>Ensure your Tailscale network is active on your computer, backend server, and reverse proxy.</p>
            
            <h4>Recommended Approach: Allow Appropriate Firewall Rules</h4>
            <p>To learn about UFW firewall rules, visit <a href="https://help.ubuntu.com/community/UFW">this guide</a>.</p>
            <pre><code># Check current status
sudo ufw status

# For SSH
sudo ufw allow from &lt;your tailscale IP&gt; to any port 22 proto tcp # recommended

# For web server 
sudo ufw allow from &lt;reverse proxy tailscale IP&gt; to any port 80,443 proto tcp # recommended

# For Wazuh
sudo ufw allow from &lt;reverse proxy tailscale IP&gt; to any port 1514,1515,5601,55000,9200 proto tcp # recommended

# Reload the firewall
sudo ufw reload

# Check current status
sudo ufw status
            </code></pre>
            <p>Verify that all rules have been applied:</p>
            <pre><code>sudo ufw status
            </code></pre>
            <p>If everything looks good, enable UFW:</p>
            <pre><code>sudo ufw enable
            </code></pre>

            <h4>Alternative Approach: Less Secure but Simpler</h4>
            <pre><code># Check current status
sudo ufw status

# For SSH
sudo ufw allow ssh

# For web server 
sudo ufw allow http
sudo ufw allow https

# For Wazuh
sudo ufw allow from any to any port 1514,1515,5601,55000,9200 proto tcp

# Reload the firewall
sudo ufw reload
            </code></pre>
            <p>Verify that all rules have been applied:</p>
            <pre><code>sudo ufw status
            </code></pre>
            <p>If everything looks good, enable UFW:</p>
            <pre><code>sudo ufw enable
            </code></pre>
        </section>

        <section class="section">
            <h3>Adjusting the Default <code>docker-compose.yml</code></h3>
            <p>It is recommended to adjust the <code>docker-compose.yml</code> file to expose the dashboard via port <code>5601</code> instead of the default port <code>443</code>. This helps avoid conflicts when hosting multiple services on the same local backend.</p>
            <p>To do this, open the <code>docker-compose.yml</code> file:</p>
            <pre><code>cd $HOME/wazuh-docker/single-node
nano docker-compose.yml
            </code></pre>
            <p>Navigate to the following section:</p>
            <pre><code>...
  wazuh.dashboard:
    image: wazuh/wazuh-dashboard:4.10.0
    hostname: wazuh.dashboard
    restart: always
    ports:
      - 443:5601
    environment:
      - INDEXER_USERNAME=admin
      - INDEXER_PASSWORD=SecretPassword
      - WAZUH_API_URL=https://wazuh.manager
      - DASHBOARD_USERNAME=kibanaserver
      - DASHBOARD_PASSWORD=kibanaserver
      - API_USERNAME=wazuh-wui
      - API_PASSWORD=MyS3cr37P450r.*-
...
            </code></pre>
            <p>And change it to:</p>
            <pre><code>...
  wazuh.dashboard:
    image: wazuh/wazuh-dashboard:4.10.0
    hostname: wazuh.dashboard
    restart: always
    ports:
      - 5601:5601 # Now exposing dashboard to 5601
    environment:
      - INDEXER_USERNAME=admin
      - INDEXER_PASSWORD=SecretPassword
      - WAZUH_API_URL=https://wazuh.manager
      - DASHBOARD_USERNAME=kibanaserver
      - DASHBOARD_PASSWORD=kibanaserver
      - API_USERNAME=wazuh-wui
      - API_PASSWORD=MyS3cr37P450r.*-
...
            </code></pre>
        </section>

        <section class="section">
            <h3>Start Up Wazuh in Docker</h3>
            <p>Start the Docker containers:</p>
            <pre><code>cd $HOME/wazuh-docker/single-node
docker compose up -d
            </code></pre>
        </section>

        <section class="section">
            <h3>Verify Your Installation</h3>
            <p>Check that all Docker containers are running:</p>
            <pre><code>docker ps
            </code></pre>
        </section>

        <section class="section">
            <h3>Access via the Browser</h3>
            <p>Access the Wazuh instance locally via your browser:</p>
            <p><a href="https://&lt;backend tailscale IP&gt;:5601" target="_blank" rel="noopener noreferrer">https://&lt;backend tailscale IP&gt;:5601</a></p>
            <p>You should see your Wazuh login page available here.</p>
        </section>

        <section class="section">
            <h3>Securing Your Installation</h3>
            
            <h4>Change Default Credentials</h4>
            <p><strong>The oldest vulnerability in the world is default credentials, so make sure you change them.</strong> Please see the Wazuh documentation <a href="https://documentation.wazuh.com/current/deployment-options/docker/wazuh-container.html">here</a> for changing default passwords and other security measures.</p>
            
            <h4>Install Fail2Ban</h4>
            <pre><code>sudo apt update
sudo apt install fail2ban
            </code></pre>
        </section>

        <section class="section">
            <h3>Establishing a Reverse Proxy</h3>
            <p><strong>This should only be done after you are comfortable with the security of your installation.</strong> Once you expose your installation via a reverse proxy, it becomes accessible from the internet.</p>
            <p>The internet is a wild place, and if you do not secure it properly, you are potentially exposing your local LAN to threats. Not a good idea.</p>
            <p>If you are comfortable with the security of your installation, proceed to enabling the reverse proxy by visiting our reverse proxy repository, <a href="https://github.com/CodeMonkeyCybersecurity/hecate">Hecate</a>.</p>
            <p>If you choose to do this, please make sure to change the default passwords <strong>before</strong> exposing it to the internet. For instructions on how to do this, please see the <a href="https://github.com/CodeMonkeyCybersecurity/eos/edit/main/legacy/wazuh/postInstallSteps.md">post-install steps</a>.</p>
        </section>

        <section class="section">
            <h3>Exposed Ports</h3>
            <p>By default, the stack exposes the following ports:</p>
            <table>
                <thead>
                    <tr>
                        <th>Port</th>
                        <th>Protocol</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1514</td>
                        <td>Wazuh TCP</td>
                    </tr>
                    <tr>
                        <td>1515</td>
                        <td>Wazuh TCP</td>
                    </tr>
                    <tr>
                        <td>514</td>
                        <td>Wazuh UDP</td>
                    </tr>
                    <tr>
                        <td>55000</td>
                        <td>Wazuh API</td>
                    </tr>
                    <tr>
                        <td>9200</td>
                        <td>Wazuh Indexer HTTPS</td>
                    </tr>
                    <tr>
                        <td>443</td>
                        <td>Wazuh Dashboard HTTPS</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section class="section">
            <h2>Next: changing default usernames</h2>
            <a href="change_default_usernames.html" class="btn">Change default usernames</a>
            <a href="../../athena.html" class="btn">Return to knowledge base home</a>
        </section>

        <section class="section">
            <h2>Return home</h2>
            <a href="../../../index.html" class="btn">Return to main page</a>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 Code Monkey Cybersecurity. ABN: 77 177 673 061. All rights reserved.</p>
    </footer>

    <!-- Optional: Add some basic styling for tables -->
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            border: 1px solid #e0e0e0;
            padding: 8px 12px;
            text-align: left;
        }

        th {
            background-color: #f0f0f0;
        }

        /* Responsive table */
        @media (max-width: 600px) {
            table, thead, tbody, th, td, tr { 
                display: block; 
            }

            th, td {
                box-sizing: border-box;
                width: 100%;
            }

            th {
                background-color: transparent;
                border-bottom: none;
                padding-top: 15px;
            }

            tr {
                margin-bottom: 15px;
            }
        }
    </style>
</body>
</html>
